<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dajin Lee Weather</title>
    <link rel="stylesheet" type="text/css" href="./style.css">

    <script type="text/javascript">

        function KtoF(kelvin) {
            // 9/5 (K - 273) + 32
            return Math.round((9 / 5 * kelvin - 459.67) * 100) / 100;
        }

        window.onload = function() {

            var xhr = new XMLHttpRequest();
            xhr.open('GET', "http://localhost:3000/weather");
            xhr.responseType = 'json';
            xhr.onload = function() {
                console.log(this.response);
                var weatherInfo = document.getElementById("weatherInfo");
                var text;

                if (this.response && this.response.success) {
                    const res = this.response.payload;

                    // Weather
                    for (let w of res.weather) {
                        var weather = document.createElement('p');
                        text = document.createTextNode("Weather: " + w.main + ", " + w.description);
                        weather.appendChild(text);
                        weatherInfo.appendChild(weather);
                    }

                    // Main
                    if (res.main) {
                        if (res.main.temp) {
                            var temp = document.createElement('p');
                            text = document.createTextNode("Temperature: " + KtoF(res.main.temp) + "F  (" +
                                        KtoF(res.main.temp_min) + "F-" + KtoF(res.main.temp_max) + "F)");
                            temp.appendChild(text);
                            weatherInfo.appendChild(temp); // .temp_min , .temp_max
                        }

                        if (res.main.pressure) {
                            var pressure = document.createElement('p');
                            text = document.createTextNode("Pressure: " + res.main.pressure + " hPa");
                            pressure.appendChild(text);
                            weatherInfo.appendChild(pressure);
                        }

                        if (res.main.humidity) {
                            var humidity = document.createElement('p');
                            text = document.createTextNode("Humidity: " + res.main.humidity + "%");
                            humidity.appendChild(text);
                            weatherInfo.appendChild(humidity);
                        }
                    }

                    if (res.wind && res.wind.speed) {
                        var wind = document.createElement('p');
                        text = document.createTextNode("Wind: " + res.wind.speed + "m/s");
                        wind.appendChild(text);
                        weatherInfo.appendChild(wind);
                    }
                    if (res.clouds && res.clouds.all) {
                        var cloud = document.createElement('p');
                        text = document.createTextNode("Cloudiness: " + res.clouds.all + "%");
                        cloud.appendChild(text);
                        weatherInfo.appendChild(cloud);
                    }
                    if (res.rain && res.rain["3h"]) {
                        var rain = document.createElement('p');
                        text = document.createTextNode("Rain (past 3hrs): " + res.rain["3h"] + "%");
                        rain.appendChild(text);
                        weatherInfo.appendChild(rain);
                    }
                    if (res.snow && res.snow["3h"]) {
                        var snow = document.createElement('p');
                        text = document.createTextNode("Snow (past 3hrs): " + res.rain["3h"] + "%");
                        snow.appendChild(text);
                        weatherInfo.appendChild(snow);
                    }
                }else {
                    var err = document.createElement('p');
                    text = document.createTextNode("Ran into an error");
                    err.appendChild(text);
                    weatherInfo.appendChild(err);
                }
            };
            xhr.send();

        }
    </script>
</head>
<body>
    <h1> Philadelphia Weather - by Jin Lee </h1>
    <h4 class="disclaimer"> ** Used the Open Weather Map API due to inability to access the Weather Underground API **</h4>
    <hr/>
    <div id="weatherInfo">

    </div>
</body>
</html>